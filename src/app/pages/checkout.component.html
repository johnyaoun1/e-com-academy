<!-- Updated Checkout Template with Save Payment Option -->
<div class="checkout-page">
  <div class="container">
    <h1>Checkout</h1>

    <!-- Processing Overlay -->
    <div *ngIf="isProcessing" class="processing-overlay">
      <div class="processing-modal">
        <div class="spinner"></div>
        <h3>Processing Payment...</h3>
        <p>Please wait while we process your order</p>
      </div>
    </div>

    <!-- Success Modal -->
    <div *ngIf="showSuccessModal" class="success-overlay">
      <div class="success-modal">
        <div class="success-icon">
          <i class="fas fa-check-circle"></i>
        </div>
        <h2>Payment Successful!</h2>
        <div class="success-details" *ngIf="orderDetails">
          <p><strong>Order #{{orderDetails.orderId}}</strong></p>
          <p>Total: <strong>${{orderDetails.total | number:'1.2-2'}}</strong></p>
          <p>Customer: {{orderDetails.customerName}}</p>
          <p>Items: {{orderDetails.itemCount}} items</p>
          <!-- Show payment method used -->
          <p>Payment: {{orderDetails.paymentMethod.type.toUpperCase()}} ending in {{orderDetails.paymentMethod.lastFour}}</p>
        </div>
        <div class="success-actions">
          <button class="btn btn-primary" (click)="goToProfile()">
            View Payment Methods
          </button>
          <button class="btn btn-secondary" (click)="continueShopping()">
            Continue Shopping
          </button>
        </div>
        <button class="close-btn" (click)="closeSuccessModal()">Ã—</button>
      </div>
    </div>

    <!-- Main Form -->
    <form [formGroup]="checkoutForm" (ngSubmit)="placeOrder()" class="checkout-form">
      <div class="form-section">
        <h2>Shipping Information</h2>
        
        <div class="form-row">
          <div class="form-group">
            <label>First Name *</label>
            <input type="text" formControlName="firstName" class="form-control">
          </div>
          <div class="form-group">
            <label>Last Name *</label>
            <input type="text" formControlName="lastName" class="form-control">
          </div>
        </div>

        <div class="form-group">
          <label>Email *</label>
          <input type="email" formControlName="email" class="form-control">
        </div>

        <div class="form-group">
          <label>Phone *</label>
          <input type="tel" formControlName="phone" class="form-control">
        </div>

        <div class="form-group">
          <label>Address *</label>
          <input type="text" formControlName="address" class="form-control">
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>City *</label>
            <input type="text" formControlName="city" class="form-control">
          </div>
          <div class="form-group">
            <label>State *</label>
            <input type="text" formControlName="state" class="form-control">
          </div>
          <div class="form-group">
            <label>ZIP Code *</label>
            <input type="text" formControlName="zipCode" class="form-control">
          </div>
        </div>
      </div>

      <div class="form-section">
        <h2>Payment Information</h2>
        
       

        <div class="form-group">
          <label>Card Number *</label>
          <input type="text" formControlName="cardNumber" class="form-control">
        </div>

        <div class="form-group">
          <label>Name on Card *</label>
          <input type="text" formControlName="cardName" class="form-control">
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Expiry Date *</label>
            <input type="text" formControlName="expiryDate" placeholder="MM/YY" class="form-control">
          </div>
          <div class="form-group">
            <label>CVV *</label>
            <input type="text" formControlName="cvv" placeholder="123" class="form-control">
          </div>
        </div>

        <!-- NEW: Save Payment Method Checkbox -->
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" formControlName="savePaymentMethod">
            <span class="checkmark"></span>
            Save this payment method for future purchases
          </label>
        </div>
      </div>

      <div class="order-summary">
        <h3>Order Summary</h3>
        <div class="total-row">
          <span>Subtotal:</span>
          <span>${{cartTotal | number:'1.2-2'}}</span>
        </div>
        <div class="total-row">
          <span>Tax:</span>
          <span>${{(cartTotal * 0.08) | number:'1.2-2'}}</span>
        </div>
        <div class="total-row total-final">
          <span>Total:</span>
          <span>${{(cartTotal * 1.08) | number:'1.2-2'}}</span>
        </div>
      </div>

      <button 
        type="submit" 
        [disabled]="checkoutForm.invalid || isProcessing"
        class="place-order-btn">
        <span *ngIf="isProcessing">Processing...</span>
        <span *ngIf="!isProcessing">Place Order</span>
      </button>
    </form>
  </div>
</div>