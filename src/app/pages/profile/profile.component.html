<!-- Fixed Profile HTML Template - Removed Payment History Features -->
<div class="profile-page">
  <div class="container">
    <div class="profile-header">
      <div class="user-info">
        <div class="avatar">
          <img #avatarImg [src]="user?.avatar || getDefaultAvatar()" [alt]="user?.firstName || 'User'" (error)="onAvatarError(avatarImg)">
          <button *ngIf="isEditing" class="avatar-edit-btn" (click)="changeAvatar()">
            <i class="fas fa-camera"></i>
          </button>
          <div class="picture-overlay" *ngIf="!isEditing" (click)="triggerFileInput()">
            <i class="fas fa-camera"></i>
            <span>Change Photo</span>
          </div>
        </div>
        <div class="user-details">
          <h1>{{ user?.firstName }} {{ user?.lastName }}</h1>
          <p class="email">{{ user?.email }}</p>
          <span class="member-badge">Member since 2024</span>
        </div>
      </div>
      
      <input 
        #fileInput
        type="file" 
        accept="image/*" 
        (change)="onFileSelected($event)"
        style="display: none;" />
    </div>

    <div class="profile-content">
      <div class="profile-sidebar">
        <nav class="profile-nav">
          <a [class.active]="activeTab === 'details'" (click)="setActiveTab('details')">
            <i class="fas fa-user"></i> Profile Details
          </a>
          <a [class.active]="activeTab === 'orders'" (click)="setActiveTab('orders')">
            <i class="fas fa-shopping-bag"></i> My Orders
            <span class="badge" *ngIf="orders.length > 0">{{ orders.length }}</span>
          </a>
          <a [class.active]="activeTab === 'payment'" (click)="setActiveTab('payment')">
            <i class="fas fa-credit-card"></i> Payment Methods
            <span class="badge" *ngIf="paymentMethods.length > 0">{{ paymentMethods.length }}</span>
          </a>
          <!-- Removed Payment History tab since it's not supported -->
        </nav>
      </div>

      <div class="profile-main">
        <!-- Success Message -->
        <div *ngIf="successMessage" class="toast toast-success">
          <i class="fas fa-check-circle"></i>
          {{ successMessage }}
        </div>

        <!-- Loading State -->
        <div *ngIf="loading" class="loading-container">
          <div class="spinner"></div>
          <p>Loading...</p>
        </div>

        <!-- Error State -->
        <div *ngIf="error" class="error-message">
          <i class="fas fa-exclamation-triangle"></i>
          {{ error }}
          <button (click)="retry()">Retry</button>
        </div>

        <!-- Profile Details Tab -->
        <div *ngIf="activeTab === 'details' && !loading" class="profile-section">
          <div class="section-header">
            <h2>Profile Details</h2>
            <div class="section-actions">
              <button *ngIf="!isEditing" class="edit-btn" (click)="toggleEdit()">
                <i class="fas fa-edit"></i> Edit Profile
              </button>
              <button *ngIf="isEditing" class="cancel-btn" (click)="cancelEdit()">
                <i class="fas fa-times"></i> Cancel
              </button>
            </div>
          </div>

          <form [formGroup]="profileForm" (ngSubmit)="saveProfile()" class="profile-form">
            <div class="form-section">
              <h3>Personal Information</h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="firstName">First Name *</label>
                  <input 
                    id="firstName"
                    type="text" 
                    formControlName="firstName" 
                    [readonly]="!isEditing"
                    [class.error]="getFieldError('firstName')"
                    class="form-control" />
                  <span class="error-text" *ngIf="getFieldError('firstName')">
                    {{ getFieldError('firstName') }}
                  </span>
                </div>
                <div class="form-group">
                  <label for="lastName">Last Name *</label>
                  <input 
                    id="lastName"
                    type="text" 
                    formControlName="lastName" 
                    [readonly]="!isEditing"
                    [class.error]="getFieldError('lastName')"
                    class="form-control" />
                  <span class="error-text" *ngIf="getFieldError('lastName')">
                    {{ getFieldError('lastName') }}
                  </span>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="email">Email *</label>
                  <input 
                    id="email"
                    type="email" 
                    formControlName="email" 
                    [readonly]="!isEditing"
                    [class.error]="getFieldError('email')"
                    class="form-control" />
                  <span class="error-text" *ngIf="getFieldError('email')">
                    {{ getFieldError('email') }}
                  </span>
                </div>
                <div class="form-group">
                  <label for="phone">Phone</label>
                  <input 
                    id="phone"
                    type="tel" 
                    formControlName="phone" 
                    [readonly]="!isEditing"
                    [class.error]="getFieldError('phone')"
                    class="form-control" />
                  <span class="error-text" *ngIf="getFieldError('phone')">
                    {{ getFieldError('phone') }}
                  </span>
                </div>
              </div>

              <div class="form-group">
                <label for="username">Username *</label>
                <input 
                  id="username"
                  type="text" 
                  formControlName="username" 
                  readonly
                  class="form-control"
                  title="Username cannot be changed" />
                <small class="help-text">Username cannot be changed</small>
              </div>
            </div>

            <div *ngIf="isEditing" class="form-actions">
              <button type="button" class="btn btn-secondary" (click)="cancelEdit()">
                Cancel
              </button>
              <button 
                type="submit" 
                [disabled]="profileForm.invalid || saving"
                class="btn btn-primary">
                <i class="fas fa-spinner fa-spin" *ngIf="saving"></i>
                <i class="fas fa-save" *ngIf="!saving"></i>
                {{ saving ? 'Saving...' : 'Save Changes' }}
              </button>
            </div>
          </form>
        </div>

        <!-- Orders Tab -->
        <div *ngIf="activeTab === 'orders' && !loading" class="profile-section">
          <div class="section-header">
            <h2>My Orders ({{ orders.length }})</h2>
            <div class="orders-filter">
              <select [(ngModel)]="orderFilter" (change)="filterOrders()">
                <option value="all">All Orders</option>
                <option value="processing">Processing</option>
                <option value="shipped">Shipped</option>
                <option value="delivered">Delivered</option>
                <option value="cancelled">Cancelled</option>
              </select>
            </div>
          </div>
          
          <div class="orders-list" *ngIf="filteredOrders.length > 0">
            <div *ngFor="let order of filteredOrders" class="order-card">
              <div class="order-header">
                <div class="order-info">
                  <span class="order-number">#{{ order.id }}</span>
                  <span class="order-date">{{ getOrderDate(order.date) }}</span>
                  <span class="customer-name">{{ order.customerName }}</span>
                </div>
                <span class="order-status" [class]="order.status.toLowerCase()">{{ order.status }}</span>
              </div>
              
              <div class="order-items">
                <div *ngFor="let item of order.items" class="order-item">
                  <img [src]="item.image" [alt]="item.name" class="item-image">
                  <div class="item-details">
                    <h4>{{ item.name }}</h4>
                    <p>Quantity: {{ item.quantity }}</p>
                    <p>Price: ${{ item.price.toFixed(2) }}</p>
                  </div>
                  <span class="item-total">${{ (item.price * item.quantity).toFixed(2) }}</span>
                </div>
              </div>
              
              <div class="order-details">
                <div class="shipping-info">
                  <h5>Shipping Address:</h5>
                  <p>{{ order.shippingAddress.address }}</p>
                  <p>{{ order.shippingAddress.city }}, {{ order.shippingAddress.state }} {{ order.shippingAddress.zipCode }}</p>
                  <p>{{ order.shippingAddress.country }}</p>
                </div>
                <div class="payment-info">
                  <h5>Payment:</h5>
                  <p>{{ order.paymentMethod.cardType }} ending in {{ order.paymentMethod.cardLast4 }}</p>
                  <!-- Removed trackingNumber since it doesn't exist in your Order interface -->
                </div>
              </div>
              
              <div class="order-footer">
                <span class="order-total">Total: ${{ order.total.toFixed(2) }}</span>
                <div class="order-actions">
                  <button class="btn btn-outline" (click)="viewOrder(order.id)">View Details</button>
                  <button 
                    *ngIf="order.status === 'Delivered'" 
                    class="btn btn-primary" 
                    (click)="reorder(order.id)">
                    Reorder
                  </button>
                  <button 
                    *ngIf="order.status !== 'Delivered' && order.status !== 'Cancelled'" 
                    class="btn btn-primary" 
                    (click)="reorder(order.id)">
                    Buy Again
                  </button>
                </div>
              </div>
            </div>
          </div>
          
          <div *ngIf="filteredOrders.length === 0 && !loading" class="empty-state">
            <i class="fas fa-shopping-bag"></i>
            <h3>No orders found</h3>
            <p *ngIf="orderFilter === 'all'">You haven't placed any orders yet</p>
            <p *ngIf="orderFilter !== 'all'">No orders match the selected filter: {{ orderFilter }}</p>
            <p *ngIf="orders.length > 0 && orderFilter !== 'all'" class="filter-help">
              You have {{ orders.length }} total orders. Try changing the filter above.
            </p>
            <button class="btn btn-primary" (click)="goToShop()">Start Shopping</button>
          </div>
        </div>

        <!-- Payment Methods Tab -->
        <div *ngIf="activeTab === 'payment' && !loading" class="profile-section">
          <div class="section-header">
            <h2>Payment Methods</h2>
            <button class="add-btn" (click)="addPaymentMethod()">
              <i class="fas fa-plus"></i> Add Payment Method
            </button>
          </div>
          
          <div class="payment-methods" *ngIf="paymentMethods.length > 0">
            <div *ngFor="let payment of paymentMethods" class="payment-card" [class.default]="payment.isDefault">
              <div class="card-info">
                <div class="card-type">
                  <i [class]="getCardIcon(payment.type)"></i>
                  <span>{{ payment.type.toUpperCase() }}</span>
                  <span *ngIf="payment.isDefault" class="default-badge">Default</span>
                </div>
                <div class="card-number">**** **** **** {{ payment.lastFour }}</div>
                <div class="card-expiry">Expires {{ payment.expiryMonth }}/{{ payment.expiryYear }}</div>
                <div class="card-holder">{{ payment.holderName }}</div>
              </div>
              <div class="card-actions">
                <button *ngIf="!payment.isDefault" class="btn btn-sm" (click)="setDefaultPayment(payment.id)">
                  Set as Default
                </button>
                <button class="btn btn-sm btn-outline" (click)="editPaymentMethod(payment.id)">
                  Edit
                </button>
                <button class="btn btn-sm btn-danger" (click)="removePaymentMethod(payment.id)">
                  Remove
                </button>
              </div>
            </div>
          </div>
          
          <div *ngIf="paymentMethods.length === 0" class="empty-state">
            <i class="fas fa-credit-card"></i>
            <h3>No payment methods</h3>
            <p>Add a payment method to make checkout faster</p>
            <button class="btn btn-primary" (click)="addPaymentMethod()">Add Payment Method</button>
          </div>
        </div>

        <!-- Removed Payment History Tab completely since it's not supported by your OrderService -->
      </div>
    </div>
  </div>
</div>