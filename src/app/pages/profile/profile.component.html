<!-- Ultra Simple Profile Template - No ÉµassertType Errors -->
<div class="profile-page">
  <div class="container">
    <div class="profile-header">
      <div class="user-info">
        <div class="avatar">
          <!-- Simplified img tag - no complex expressions -->
          <img [src]="getUserAvatar()" alt="User Avatar" (error)="handleAvatarError($event)">
          
          <button *ngIf="isEditing" class="avatar-edit-btn" (click)="changeAvatar()">
            <i class="fas fa-camera"></i>
          </button>
          
          <div class="picture-overlay" *ngIf="!isEditing" (click)="triggerFileInput()">
            <i class="fas fa-camera"></i>
            <span>Change Photo</span>
          </div>
        </div>
        
        <div class="user-details">
          <h1>{{ getUserFullName() }}</h1>
          <p class="email">{{ getUserEmail() }}</p>
          <span class="member-badge">Member since 2024</span>
        </div>
      </div>
      
      <!-- Simple input tag -->
      <input #fileInput type="file" accept="image/*" (change)="onFileSelected($event)" style="display: none">
    </div>

    <div class="profile-content">
      <div class="profile-sidebar">
        <nav class="profile-nav">
          <a [class.active]="activeTab === 'details'" (click)="setActiveTab('details')">
            <i class="fas fa-user"></i> Profile Details
          </a>
          
          <a [class.active]="activeTab === 'orders'" (click)="setActiveTab('orders')">
            <i class="fas fa-shopping-bag"></i> My Orders
            <span class="badge" *ngIf="getOrdersCount() > 0">{{ getOrdersCount() }}</span>
          </a>
          
          <a [class.active]="activeTab === 'payment'" (click)="setActiveTab('payment')">
            <i class="fas fa-credit-card"></i> Payment Methods
            <span class="badge" *ngIf="getPaymentMethodsCount() > 0">{{ getPaymentMethodsCount() }}</span>
          </a>
        </nav>
      </div>

      <div class="profile-main">
        <!-- Success Message -->
        <div *ngIf="successMessage" class="toast toast-success">
          <i class="fas fa-check-circle"></i>
          {{ successMessage }}
        </div>

        <!-- Loading State -->
        <div *ngIf="loading" class="loading-container">
          <div class="spinner"></div>
          <p>Loading...</p>
        </div>

        <!-- Error State -->
        <div *ngIf="error" class="error-message">
          <i class="fas fa-exclamation-triangle"></i>
          {{ error }}
          <button (click)="retry()">Retry</button>
        </div>

        <!-- Profile Details Tab -->
        <div *ngIf="activeTab === 'details' && !loading" class="profile-section">
          <div class="section-header">
            <h2>Profile Details</h2>
            <div class="section-actions">
              <button *ngIf="!isEditing" class="edit-btn" (click)="toggleEdit()">
                <i class="fas fa-edit"></i> Edit Profile
              </button>
              <button *ngIf="isEditing" class="cancel-btn" (click)="cancelEdit()">
                <i class="fas fa-times"></i> Cancel
              </button>
            </div>
          </div>

          <form [formGroup]="profileForm" (ngSubmit)="saveProfile()" class="profile-form">
            <div class="form-section">
              <h3>Personal Information</h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="firstName">First Name *</label>
                  <input 
                    id="firstName"
                    type="text" 
                    formControlName="firstName" 
                    [readonly]="!isEditing"
                    class="form-control">
                  <span class="error-text" *ngIf="hasFieldError('firstName')">
                    {{ getFieldError('firstName') }}
                  </span>
                </div>
                <div class="form-group">
                  <label for="lastName">Last Name *</label>
                  <input 
                    id="lastName"
                    type="text" 
                    formControlName="lastName" 
                    [readonly]="!isEditing"
                    class="form-control">
                  <span class="error-text" *ngIf="hasFieldError('lastName')">
                    {{ getFieldError('lastName') }}
                  </span>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="email">Email *</label>
                  <input 
                    id="email"
                    type="email" 
                    formControlName="email" 
                    [readonly]="!isEditing"
                    class="form-control">
                  <span class="error-text" *ngIf="hasFieldError('email')">
                    {{ getFieldError('email') }}
                  </span>
                </div>
                <div class="form-group">
                  <label for="phone">Phone</label>
                  <input 
                    id="phone"
                    type="tel" 
                    formControlName="phone" 
                    [readonly]="!isEditing"
                    class="form-control">
                  <span class="error-text" *ngIf="hasFieldError('phone')">
                    {{ getFieldError('phone') }}
                  </span>
                </div>
              </div>

              <div class="form-group">
                <label for="username">Username *</label>
                <input 
                  id="username"
                  type="text" 
                  formControlName="username" 
                  readonly
                  class="form-control">
                <small class="help-text">Username cannot be changed</small>
              </div>
            </div>

            <div *ngIf="isEditing" class="form-actions">
              <button type="button" class="btn btn-secondary" (click)="cancelEdit()">
                Cancel
              </button>
              <button 
                type="submit" 
                [disabled]="isFormInvalid() || saving"
                class="btn btn-primary">
                <i class="fas fa-spinner fa-spin" *ngIf="saving"></i>
                <i class="fas fa-save" *ngIf="!saving"></i>
                {{ getSaveButtonText() }}
              </button>
            </div>
          </form>
        </div>

        <!-- Orders Tab -->
        <div *ngIf="activeTab === 'orders' && !loading" class="profile-section">
          <div class="section-header">
            <h2>My Orders ({{ getOrdersCount() }})</h2>
            <div class="orders-filter">
              <select [(ngModel)]="orderFilter" (change)="filterOrders()">
                <option value="all">All Orders</option>
              
              </select>
            </div>
          </div>
          
          <div class="orders-list" *ngIf="hasFilteredOrders()">
            <div *ngFor="let order of filteredOrders" class="order-card">
              <div class="order-header">
                <div class="order-info">
                  <span class="order-number">#{{ order.id }}</span>
                  <span class="order-date">{{ getOrderDate(order.date) }}</span>
                  <span class="customer-name">{{ order.customerName }}</span>
                </div>
                <span class="order-status" [ngClass]="getOrderStatusClass(order.status)">{{ order.status }}</span>
              </div>
              
              <div class="order-items">
                <div *ngFor="let item of order.items" class="order-item">
                  <img [src]="item.image" [alt]="item.name" class="item-image">
                  <div class="item-details">
                    <h4>{{ item.name }}</h4>
                    <p>Quantity: {{ item.quantity }}</p>
                    <p>Price: ${{ formatPrice(item.price) }}</p>
                  </div>
                  <span class="item-total">${{ formatPrice(item.price * item.quantity) }}</span>
                </div>
              </div>
              
              <div class="order-details">
                <div class="shipping-info">
                  <h5>Shipping Address:</h5>
                  <p>{{ order.shippingAddress.address }}</p>
                  <p>{{ getShippingLocation(order.shippingAddress) }}</p>
                  <p>{{ order.shippingAddress.country }}</p>
                </div>
                <div class="payment-info">
                  <h5>Payment:</h5>
                  <p>{{ getPaymentMethodDisplay(order.paymentMethod) }}</p>
                </div>
              </div>
              
              <div class="order-footer">
                <span class="order-total">Total: ${{ formatPrice(order.total) }}</span>
                <div class="order-actions">
                  <button class="btn btn-outline" (click)="viewOrder(order.id)">View Details</button>
                  <button 
                    *ngIf="canReorder(order.status)" 
                    class="btn btn-primary" 
                    (click)="reorder(order.id)">
                    {{ getReorderButtonText(order.status) }}
                  </button>
                </div>
              </div>
            </div>
          </div>
          
          <div *ngIf="!hasFilteredOrders()" class="empty-state">
            <i class="fas fa-shopping-bag"></i>
            <h3>No orders found</h3>
            <p>{{ getEmptyOrdersMessage() }}</p>
            <button class="btn btn-primary" (click)="goToShop()">Start Shopping</button>
          </div>
        </div>

        <!-- Payment Methods Tab -->
        <div *ngIf="activeTab === 'payment' && !loading" class="profile-section">
          <div class="section-header">
            <h2>Payment Methods</h2>
           
          </div>
          
          <div class="payment-methods" *ngIf="hasPaymentMethods()">
            <div *ngFor="let payment of paymentMethods" class="payment-card" [ngClass]="getPaymentCardClass(payment.isDefault)">
              <div class="card-info">
                <div class="card-type">
                  <i [ngClass]="getCardIcon(payment.type)"></i>
                  <span>{{ payment.type.toUpperCase() }}</span>
                  <span *ngIf="payment.isDefault" class="default-badge">Default</span>
                </div>
                <div class="card-number">**** **** **** {{ payment.lastFour }}</div>
                <div class="card-expiry">Expires {{ payment.expiryMonth }}/{{ payment.expiryYear }}</div>
                <div class="card-holder">{{ payment.holderName }}</div>
              </div>
              <div class="card-actions">
                <button *ngIf="!payment.isDefault" class="btn btn-sm" (click)="setDefaultPayment(payment.id)">
                  Set as Default
                </button>
                <button class="btn btn-sm btn-outline" (click)="editPaymentMethod(payment.id)">
                  Edit
                </button>
                <button class="btn btn-sm btn-danger" (click)="removePaymentMethod(payment.id)">
                  Remove
                </button>
              </div>
            </div>
          </div>
          
          <div *ngIf="!hasPaymentMethods()" class="empty-state">
            <i class="fas fa-credit-card"></i>
            <h3>No payment methods</h3>
            <p>Add a payment method to make checkout faster</p>
            <button class="btn btn-primary" (click)="addPaymentMethod()">Add Payment Method</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>