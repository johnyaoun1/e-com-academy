<header class="header">
  <nav class="nav">
    <div class="logo" routerLink="/">InMind</div>
    
    <!-- ✅ Desktop Search Section -->
    <div class="search-section">
      <app-search-bar (search)="onSearch($event)" (close)="onSearchClose()"></app-search-bar>
    </div>
    
    <ul class="nav-links">
      <li><a routerLink="/products">SHOP</a></li>
      <li><a routerLink="/about">ABOUT US</a></li>
      <li><a routerLink="/contact">CONTACT US</a></li>
    </ul>
    
    <div class="nav-icons">
      <!-- ✅ Mobile Search Toggle (shows only on mobile) -->
      <button class="mobile-search-toggle" (click)="toggleMobileSearch()" *ngIf="!showMobileSearch">
        <i class="fas fa-search"></i>
      </button>
      
      <!-- ✅ Mobile Search Close (shows when mobile search is open) -->
      <button class="mobile-search-close" (click)="toggleMobileSearch()" *ngIf="showMobileSearch">
        <i class="fas fa-times"></i>
      </button>
      
      <!-- ✅ Favorites Button -->
      <div class="favorites-wrapper">
        <button 
          class="header-action-btn favorites-btn" 
          (click)="navigateToFavorites()"
          [attr.aria-label]="'View favorites (' + (favoritesCount$ | async) + ' items)'">
          <div class="icon-wrapper">
            <svg 
              width="24" 
              height="24" 
              viewBox="0 0 24 24" 
              fill="none" 
              stroke="currentColor" 
              stroke-width="2">
              <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
            </svg>
            <span 
              class="count-badge" 
              *ngIf="(favoritesCount$ | async) as count"
              [class.has-items]="count > 0">
              {{ count > 99 ? '99+' : count }}
            </span>
          </div>
        </button>
      </div>
      
      <app-cart-header></app-cart-header>
      
      <div class="user-menu" *ngIf="currentUser$ | async as user; else loginButton">
        <div class="user-avatar" (click)="toggleUserMenu()">
          <img 
            *ngIf="user.profilePicture || user.avatar" 
            [src]="user.profilePicture || user.avatar" 
            [alt]="user.username"
            class="avatar-img">
          <div *ngIf="!user.profilePicture && !user.avatar" class="avatar-placeholder">
            {{ (user.firstname || user.firstName || user.username || 'U').charAt(0).toUpperCase() }}
          </div>
          <i class="fas fa-chevron-down dropdown-icon"></i>
        </div>
        
        <div class="dropdown-menu" [class.show]="showUserMenu">
          <div class="user-info">
            <div class="user-name">{{ user.firstname || user.firstName || user.username }}</div>
            <div class="user-email">{{ user.email }}</div>
          </div>
          <div class="menu-divider"></div>
          <button class="menu-item" (click)="goToProfile()">
            <i class="fas fa-user"></i>
            My Profile
          </button>
          <button class="menu-item" routerLink="/cart" (click)="showUserMenu = false">
            <i class="fas fa-shopping-cart"></i>
            My Cart
          </button>
          <button class="menu-item" (click)="navigateToFavorites(); showUserMenu = false">
            <i class="fas fa-heart"></i>
            My Favorites
          </button>
          <button class="menu-item" *ngIf="user.role === 'admin'" routerLink="/admin" (click)="showUserMenu = false">
            <i class="fas fa-cog"></i>
            Admin Panel
          </button>
          <div class="menu-divider"></div>
          <button class="menu-item logout" (click)="logout()">
            <i class="fas fa-sign-out-alt"></i>
            Logout
          </button>
        </div>
      </div>
      
      <ng-template #loginButton>
        <button class="login-btn" (click)="goToLogin()">
          <i class="fas fa-user"></i>
          Login
        </button>
      </ng-template>
    </div>
  </nav>
  
  <!-- ✅ Mobile Search Bar (slides down when toggled) -->
  <div class="mobile-search-bar" [class.active]="showMobileSearch">
    <div class="mobile-search-content">
      <app-search-bar (search)="onMobileSearch($event)" (close)="toggleMobileSearch()"></app-search-bar>
    </div>
  </div>
  
  <div class="backdrop" [class.show]="showUserMenu" (click)="onClickOutside()"></div>
</header>